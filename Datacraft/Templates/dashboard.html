<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    
 
    <link rel="stylesheet" href="/static/dash.css">
    <link rel="stylesheet" href="https://unpkg.com/boxicons@latest/css/boxicons.min.css">
    <title>Side Panel and Dashboard</title>
</head>

<body>
    <div>
        <div class="navbar">
            <div class="logo">
                <a href="/">
                    <img src="/static/img/logo1.png" alt="Logo">
                </a>
            </div>
            <div class="search">
                <input type="text" placeholder="Search...">
                <button><i class="fa fa-search"></i></button>
            </div>
            <div class="user">
                <div class="dropdown">
                    <div class="dropbtn" id="userIcon">
                        <i class='bx bxs-user-circle'></i>
                    </div>
                    <div class="dropdown-content" id="dropdownContent">
                        <a href="/profile">My Profile</a>
                        <a href="/dashboard">Dashboard</a>
                        <a href="/logout">Logout</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <section class="both">

        <div class="side-panel">
            <ul>
                <li><a href="#"><i class='bx bx-upload'></i> File Upload</a></li>
                <li><a href="#"><i class='bx bxs-dashboard'></i> Dashboard</a></li>
            </ul>
        </div>

        <div class="content">

            {% if messages %}

            {% for msg in messages %}

            <div class="alert alert-warning alert-dismissible fade show" role="alert">
                <strong>{{ msg }}</strong> 
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
              </div>
                
            {% endfor %}

            {% endif %}



            <section id="file-upload-section">
                
                {% if value%}
                <h1 style="text-decoration: underline; font-family: sans-serif; ">{{filename}}</h1>
                <div id="file" style="overflow-y: auto; max-height: 50vw; max-width: max-content; background: #f4f4f4;">
                <table border="1" cellspacing="0" style="border: 1px solid black;" > 
                    <tbody style="
                    font-family: verdana,arial,sans-serif;
                    font-size:11px;
                    color:#333333;
                    border: 1px solid #666666;
                    border-collapse: collapse;
                    "> 
                        <tr style="padding: 8px;
                        border: 1px #666666;
                        background-color: #ffffff;">
                          {% for key in MyData_key1%}
                          <td style="padding: 8px;
                          border: 1px solid #666666;
                          background-color: #ffffff;">{{ key }}</td>
                          {% endfor %}
                        </tr>
                      
                      
                        
                            {% for value in MyData_values1%}
                            <tr style="padding: 8px;
                            border: 1px solid #666666;
                            background-color: #ffffff;">
                              {% for value1 in value %}
                                <td style="padding: 8px;
                                border: 1px solid #666666;
                                background-color: #ffffff;">{{value1}}</td>
                              {% endfor %}
                           </tr>
                           {% endfor %}
                    </tbody> 
                  </table>
                </div>
                


                <br><br><br>
                <div id="file" style="overflow-y: auto; max-height: 50vw; max-width: max-content; background: #f4f4f4;">


                    <table border="1" cellspacing="0" style="border: 1px solid black;" > 
                        <tbody style="
                        font-family: verdana,arial,sans-serif;
                        font-size:11px;
                        color:#333333;
                        border: 1px solid #666666;
                        border-collapse: collapse;
                        "> 
                            <tr style="padding: 8px;
                            border: 1px #666666;
                            background-color: #ffffff;">
                              {% for key in MyData_key2%}
                              <td style="padding: 8px;
                              border: 1px solid #666666;
                              background-color: #ffffff;">{{ key }}</td>
                              {% endfor %}
                            </tr>
                          
                          
                            
                                {% for value in MyData_values2%}
                                <tr style="padding: 8px;
                                border: 1px solid #666666;
                                background-color: #ffffff;">
                                  {% for value1 in value %}
                                    <td style="padding: 8px;
                                    border: 1px solid #666666;
                                    background-color: #ffffff;">{{value1}}</td>
                                  {% endfor %}
                               </tr>
                               {% endfor %}
                        </tbody> 
                      </table>
                    </div>
                
                
                
                
                
                
                <br>
                
                <a href="{%url 'dashboard'%}"><button type = "submit" id="upload-button">Upload Again?</button></a>
                {% else %}

                    <h2 id="main-heading">File Upload</h2>
                    <div class="both-file-button">
                        <div class="file-upload-container">
                            <form method="post" action ="{%  url 'dashboard' %}"  enctype="multipart/form-data">
                                {% csrf_token %}
                                <input type="file" id="file-input" name = "file"  required>
                                <label for="file-input" class="file-input-label">
                                    <i class="bx bx-cloud-upload"></i><br>
                                    <p>Choose a File</p>
                                </label><br><br>   
                                <button type = "submit" id="upload-button">Upload</button>
                            </form>
                        </div>
                    </div>

                    <div class="examplefile">
                        <h2 id="examplefile-heading">
                            Download/Open Example File From Here...
                        </h2>
                        <a
                            href="https://docs.google.com/spreadsheets/d/10v3YWgFAsWcRAPEjjCJRG9GtpgI9zw7m/edit?usp=sharing&ouid=106087857719360116593&rtpof=true&sd=true" , target="_blank">
                            <button id="examplefile-button"> Click Here <i class='bx bxs-download'></i> </button>
                        </a>
                    </div>

                {% endif %}
            </section>

            <section id="dashboard-section">

                {% if value %}
                    <div class="chart1" style="width: 80%;
                    margin: 0 auto; 
                    background-color: #f5f5f5; 
                    padding: 20px; 
                    border-radius: 8px; 
                    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); 
                ">
                <h2>Total Sales By Months</h2>
                        <canvas id = "mychart"></canvas>
                    </div>
                    <br>
                    <div>
                        <ul>
                            <li style="color: #333;
                            margin-top: 10px;
                            position: relative;
                            left: 7vw;">
                                Highest Sales is in the month of {{high_sales}}
    
                            </li>
                            <li style="color: #333;
                            margin-top: 10px;
                            position: relative;
                            left: 7vw;">
                                Lowest Sales is in the month of {{lowest_sales}}
                            </li>
                        </ul>
                    </div>
                   
                    <br><br><br>
                    <select name = "month"  id="select" style="padding: 8px; 
                    margin-top: 10px; ">
                        <option value="0" selected style="background-color: #ffffff;">April</option>
                        <option value="1"style="background-color: #ffffff;">May</option>
                        <option value="2"style="background-color: #ffffff;">June</option>
                        <option value="3"style="background-color: #ffffff;">July</option>
                        <option value="4"style="background-color: #ffffff;">Augut</option>
                        <option value="5"style="background-color: #ffffff;">September</option>
                        <option value="6"style="background-color: #ffffff;">October</option>
                        <option value="7"style="background-color: #ffffff;">November</option>
                        <option value="8"style="background-color: #ffffff;">Deecmber</option>
                        <option value="9"style="background-color: #ffffff;">January</option>
                        <option value="10"style="background-color: #ffffff;">February</option>
                        <option value="11"style="background-color: #ffffff;">March</option>

                    </select>
                    <!-- <button id="select_button">CLICK</button> -->
                    <div class="chart2" style="width: 80%; 
                    margin: 20px auto; 
                    background-color: #ffffff; 
                    padding: 20px; 
                    border-radius: 8px; 
                    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);">
                    <h2>SKU Sales By Month</h2>
                        <canvas id="mychart2"></canvas>
                    </div>

                    <div class="goods" style="display: flex;">
                        <div class="profitable">
                            <h5>Profitable Goods</h5>
                            <ul>
                                {% for i in good_goods%}
                                <li>
                                    {{i}}
                                </li>
                                {% endfor %}
                            </ul>
                        </div>

                        <div class="non-profitable">
                            <h5>Non - Profitable Goods</h5>
                            <ul>
                                {% for i in bad_goods%}
                                <li>
                                    {{i}}
                                </li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                {% else %}
                <h2>Dashboard Section</h2>
                {%endif%}
                <!-- Content for Dashboard section goes here -->
            </section>


            <section id="reports-section">
                <h2>Reports Section</h2>
                <!-- Content for Reports section goes here -->
            </section>
        </div>

    </section>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script >
        const ctx = document.getElementById("mychart").getContext("2d");
        const ctx2 = document.getElementById("mychart2").getContext("2d");
        var labels = [];
        var val = JSON.parse("{{newdata_json|escapejs}}");
        for (var x in val){
            labels.push(x);
        }
        console.log(labels);

        var mychart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
            label: '# of Sales',
            data: [{% for number in total_sales %}'{{ number }}'  , {% endfor%}],
            borderWidth: 1
            }]
        },
        options: {
            scales: {
            y: {
                beginAtZero: true
            }
            }
        }
        });

        var mychart2 = new Chart(ctx2, {
            type: 'bar',
            data: {
                labels: [{% for sku in sku_label %}'{{ sku }}'  , {% endfor%}],
                datasets: [{
                label: '# of Sales',
                data: [{% for month in month_value_april %}'{{ month }}'  , {% endfor%}],
                borderWidth: 1
                }]
            },
            options: {
                scales: {
                y: {
                    beginAtZero: true
                }
                }
            }
            });
        

        

            
    
        document.getElementById("select").addEventListener("change", function () {
            var a = "{{month_value}}";
            var datas = [];
            var array = JSON.parse("[" + a + "]");
            console.log(array[0][0]);
            let val = document.getElementById("select").value;
            console.log(typeof val, val, array[0][0].length);
            for (let i = 0; i < array[0][0].length; i++) {
                if (i == val) {
                    datas = array[0][i.toString()];
                }
            }
        
            var b = "{{sku_label}}";
            console.log(typeof b);
            console.log(b.replace(/&#x27;/g, ""));
            label = b.replace(/&#x27;/g, "");
            label = label.split(",");
            label[0] = label[0].replace("[", "");
            label[label.length - 1] = label[label.length - 1].replace("]", "");
        
            // Destroy the existing chart before creating a new one
            destroyChart();
        
            // Create a new chart
            createChart(label, datas);
        });
        
        function createChart(label_s, data_s) {
            var ch = document.getElementById("mychart2").getContext("2d");
            var mychart2 = new Chart(ch, {
                type: 'bar',
                data: {
                    labels: label_s,
                    datasets: [{
                        label: '# of Sales',
                        data: data_s,
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        
            // Return the chart instance
            return mychart2;
        }
        
        function destroyChart() {
            // Get the existing chart instance
            var existingChart = Chart.getChart("mychart2");
        
            // If the chart exists, destroy it
            if (existingChart) {
                existingChart.destroy();
            }
        }
        
        
    </script>
    <script>

        // Get references to the side panel items and content sections
        const sidePanelItems = document.querySelectorAll('.side-panel ul li a');
        const contentSections = document.querySelectorAll('.content section');

        // Add a click event listener to each side panel item
        sidePanelItems.forEach((item, index) => {
        item.addEventListener('click', (event) => {
        event.preventDefault(); // Prevent the default link behavior

        // Hide all content sections
        contentSections.forEach((section) => {
        section.style.display = 'none';
        });

        // Show the corresponding content section based on the index
        contentSections[index].style.display = 'block';
        });
        });


        // Close the dropdown if the user clicks outside of it
        document.addEventListener('click', function(event) {
        var dropdownContent = document.getElementById('dropdownContent');
        var userIcon = document.getElementById('userIcon');

        if (!userIcon.contains(event.target) && !dropdownContent.contains(event.target)) {
        dropdownContent.classList.remove('show');
        }
        });

        document.getElementById('userIcon').addEventListener('click', function() {
        var dropdownContent = document.getElementById('dropdownContent');
        dropdownContent.classList.toggle('show');
        });

        document.getElementById("select").addEventListener("change",function selects (sku_id) {
            var val = document.getElementById("select").value;
            console.log(val);
            
        });

    </script>
</body>

</html>